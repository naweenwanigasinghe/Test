<div class="h-screen flex bg-gray-100">
  <!-- Fixed Navigation Sidebar -->
  <div class="fixed left-0 top-0 h-screen w-full md:w-72 flex-shrink-0 p-3 md:p-4 overflow-hidden z-40">
    <app-navigation></app-navigation>
  </div>
  <!-- Main Content Area with Scroll -->
  <div class="flex-1 ml-0 md:ml-72 p-4 md:p-6 lg:p-8 overflow-y-auto h-screen">
    <app-header [title]="'New File'" [showBreadcrumb]="true" [breadcrumbParent]="'File Management'"></app-header>
    <div class="mt-6"><app-step-indicator [currentStep]="currentStep" [labels]="stepLabels"></app-step-indicator></div>

    <div class="flex w-full rounded-lg bg-white shadow-card mt-6 p-6 flex-col gap-8">
      <!-- Step 1 -->
      <div *ngIf="currentStep === 1" class="w-full flex flex-col gap-6" [formGroup]="templateInfoForm">
        <div class="text-gray-900 text-lg font-medium">Basic File Information</div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
          <mat-form-field appearance="fill" class="w-full"><mat-label>File ID</mat-label><input matInput formControlName="templateId" placeholder="Enter file ID" /></mat-form-field>
          <mat-form-field appearance="fill" class="w-full"><mat-label>Entity *</mat-label><mat-select formControlName="entity"><mat-option *ngFor="let e of entityOptions" [value]="e">{{ e }}</mat-option></mat-select></mat-form-field>
          <mat-form-field appearance="fill" class="w-full"><mat-label>Sector *</mat-label><mat-select formControlName="sector" required><mat-option *ngFor="let s of sectorOptions" [value]="s">{{ s }}</mat-option></mat-select></mat-form-field>
          <mat-form-field appearance="fill" class="w-full"><mat-label>Category *</mat-label><mat-select formControlName="category" required><mat-option *ngFor="let c of categoryOptions" [value]="c">{{ c }}</mat-option></mat-select></mat-form-field>
          <mat-form-field appearance="fill" class="w-full"><mat-label>Sub - Category *</mat-label><mat-select formControlName="subCategory" required><mat-option *ngFor="let sc of subCategoryOptions" [value]="sc">{{ sc }}</mat-option></mat-select></mat-form-field>
          <mat-form-field appearance="fill" class="w-full md:col-span-1"><mat-label>File Version</mat-label><input matInput formControlName="fileVersion" placeholder="Enter version" /></mat-form-field>
        </div>
        <div class="w-full flex flex-col gap-6" [formGroup]="metadataForm">
          <div class="text-gray-900 text-lg font-medium">File Metadata & Configuration</div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
            <mat-form-field appearance="fill" class="w-full md:col-span-2"><mat-label>Description *</mat-label><textarea matInput formControlName="description" rows="5" placeholder="Enter description" required></textarea></mat-form-field>
            <mat-form-field appearance="fill" class="w-full"><mat-label>Submission Frequency *</mat-label><mat-select formControlName="submissionFrequency" required><mat-option *ngFor="let f of frequencyOptions" [value]="f">{{ f }}</mat-option></mat-select></mat-form-field>
            <mat-form-field appearance="fill" class="w-full"><mat-label>Effective Start Date *</mat-label><input matInput [matDatepicker]="startPicker" formControlName="effectiveStartDate" required><mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle><mat-datepicker #startPicker></mat-datepicker></mat-form-field>
            <mat-form-field appearance="fill" class="w-full md:col-span-1"><mat-label>Effective End Date *</mat-label><input matInput [matDatepicker]="endPicker" formControlName="effectiveEndDate" required><mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle><mat-datepicker #endPicker></mat-datepicker></mat-form-field>
          </div>
        </div>
      </div>

      <!-- Step 2: User Assign -->
      <div *ngIf="currentStep === 2" class="w-full flex flex-col gap-6">
        <div class="text-gray-900 text-base font-medium">Assign Users</div>
        <div *ngIf="userAssignView==='empty'" class="w-full rounded-2xl border border-dashed border-border bg-gray-50 p-10">
          <div class="w-full min-h-[320px] flex items-center justify-center"><div class="flex flex-col items-center gap-4 text-center"><svg width="70" height="70" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="3" fill="#D1D5DB"/><path d="M5 19c0-3.314 3.134-6 7-6s7 2.686 7 6" stroke="#9CA3AF" stroke-width="1.5" stroke-linecap="round"/><circle cx="18" cy="12" r="2.5" fill="#E5E7EB"/></svg><div class="text-gray-800">There are not any configured users</div><div class="flex flex-wrap gap-3 justify-center"><button type="button" class="h-9 px-4 rounded-md bg-primary-500 text-white" (click)="openModal('submitter')">Add Data Submitter</button><button type="button" class="h-9 px-4 rounded-md bg-primary-500 text-white" (click)="openModal('viewer')">Add Data Viewer</button><button type="button" class="h-9 px-4 rounded-md bg-primary-500 text-white" (click)="openModal('accepter')">Add Data Accepter</button></div></div></div>
        </div>
        <div *ngIf="userAssignView==='assigned'" class="w-full flex flex-col gap-4">
          <div class="flex items-center gap-3"><button type="button" class="h-9 px-4 rounded-md bg-primary-500 text-white" (click)="openModal('submitter')">Add Data Submitter</button><button type="button" class="h-9 px-4 rounded-md bg-primary-500 text-white" (click)="openModal('viewer')">Add Data Viewer</button><button type="button" class="h-9 px-4 rounded-md bg-primary-500 text-white" (click)="openModal('accepter')">Add Data Accepter</button></div>
          <div class="overflow-auto rounded-lg"><table class="w-full text-sm"><thead class="text-gray-500"><tr class="border-b"><th class="py-2 text-left font-medium">User Name</th><th class="py-2 text-left font-medium">Organization</th><th class="py-2 text-left font-medium">Type</th><th class="py-2 text-left font-medium">Permission Level</th><th class="py-2 text-left font-medium">Approval Flow</th><th class="py-2 text-left font-medium">Actions</th></tr></thead><tbody><tr *ngFor="let u of assignedUsers; let i=index" class="border-b"><td class="py-2">{{ u.name }}</td><td class="py-2">{{ u.organization }}</td><td class="py-2">{{ u.type }}</td><td class="py-2">{{ u.permission }}</td><td class="py-2">{{ u.approval }}</td><td class="py-2"><div class="flex gap-2"><button type="button" class="w-7 h-7 rounded border bg-white"></button><button type="button" class="w-7 h-7 rounded border bg-white" (click)="deleteUser(i)"></button></div></td></tr></tbody></table></div>
        </div>

        <!-- Modal Overlay for Add forms -->
        <div *ngIf="userModal" class="fixed inset-0 bg-black/40 z-40 flex items-center justify-center p-4">
          <div class="w-full max-w-4xl rounded-lg bg-white shadow-2xl p-6 relative">
            <button type="button" (click)="closeModal()" class="absolute right-4 top-4 w-8 h-8 rounded-md border bg-white">✕</button>
            <div *ngIf="userModal==='submitter'" [formGroup]="submitterForm" class="flex flex-col gap-6">
              <div class="text-gray-900 text-base font-medium">Add New Data Submitter</div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <mat-form-field appearance="fill" class="w-full"><mat-label>User</mat-label><input matInput formControlName="user" placeholder="Search"/></mat-form-field>
                <mat-form-field appearance="fill" class="w-full"><mat-label>Organization</mat-label><input matInput formControlName="organization" placeholder="Organization"/></mat-form-field>
              </div>
              <div class="text-gray-900 text-base font-medium">Approval Workflow Configuration</div>
              <mat-radio-group formControlName="approval" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <label class="border rounded-xl p-4 bg-gray-50 flex items-start gap-3 cursor-pointer"><mat-radio-button value="one-tier"></mat-radio-button><div><div class="text-sm font-semibold text-gray-800">One-Tier Approval</div><div class="text-xs text-gray-500">Single Approval From Designated Accepter</div></div></label>
                <label class="border rounded-xl p-4 bg-gray-50 flex items-start gap-3 cursor-pointer"><mat-radio-button value="two-tier"></mat-radio-button><div><div class="text-sm font-semibold text-gray-800">Two-Tier Approval</div><div class="text-xs text-gray-500">Primary Review + Senior Management Approval</div></div></label>
                <label class="border rounded-xl p-4 bg-gray-50 flex items-start gap-3 cursor-pointer"><mat-radio-button value="none"></mat-radio-button><div><div class="text-sm font-semibold text-gray-800">No Approval Required</div><div class="text-xs text-gray-500">Automatic Acceptance Upon Submission</div></div></label>
              </mat-radio-group>
              <div class="flex justify-end"><button type="button" class="h-10 px-6 rounded-md bg-orange-500 text-white" (click)="addSubmitter()">Add</button></div>
            </div>
            <div *ngIf="userModal==='viewer'" [formGroup]="viewerForm" class="flex flex-col gap-6">
              <div class="text-gray-900 text-base font-medium">Add New Data Viewer</div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <mat-form-field appearance="fill" class="w-full"><mat-label>User</mat-label><input matInput formControlName="user" placeholder="Search"/></mat-form-field>
                <mat-form-field appearance="fill" class="w-full"><mat-label>Organization</mat-label><input matInput formControlName="organization" placeholder="Organization"/></mat-form-field>
                <mat-form-field appearance="fill" class="w-full"><mat-label>Effective From</mat-label><input matInput [matDatepicker]="vFrom" formControlName="effectiveFrom"/><mat-datepicker-toggle matIconSuffix [for]="vFrom"></mat-datepicker-toggle><mat-datepicker #vFrom></mat-datepicker></mat-form-field>
                <mat-form-field appearance="fill" class="w-full"><mat-label>Effective To</mat-label><input matInput [matDatepicker]="vTo" formControlName="effectiveTo"/><mat-datepicker-toggle matIconSuffix [for]="vTo"></mat-datepicker-toggle><mat-datepicker #vTo></mat-datepicker></mat-form-field>
              </div>
              <div class="flex justify-end"><button type="button" class="h-10 px-6 rounded-md bg-orange-500 text-white" (click)="addViewer()">Add</button></div>
            </div>
            <div *ngIf="userModal==='accepter'" [formGroup]="accepterForm" class="flex flex-col gap-6">
              <div class="text-gray-900 text-base font-medium">Add New Data Accepter</div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <mat-form-field appearance="fill" class="w-full"><mat-label>User</mat-label><input matInput formControlName="user" placeholder="Search"/></mat-form-field>
                <mat-form-field appearance="fill" class="w-full"><mat-label>Organization</mat-label><input matInput formControlName="organization" placeholder="Organization"/></mat-form-field>
                <mat-form-field appearance="fill" class="w-full"><mat-label>Sector</mat-label><mat-select formControlName="sector"><mat-option *ngFor="let s of sectorOptions" [value]="s">{{ s }}</mat-option></mat-select></mat-form-field>
                <mat-form-field appearance="fill" class="w-full"><mat-label>Entity</mat-label><mat-select formControlName="entity"><mat-option *ngFor="let e of entityOptions" [value]="e">{{ e }}</mat-option></mat-select></mat-form-field>
                <mat-form-field appearance="fill" class="w-full"><mat-label>Category</mat-label><mat-select formControlName="category"><mat-option *ngFor="let c of categoryOptions" [value]="c">{{ c }}</mat-option></mat-select></mat-form-field>
                <mat-form-field appearance="fill" class="w-full"><mat-label>Sub-Category</mat-label><mat-select formControlName="subCategory"><mat-option *ngFor="let sc of subCategoryOptions" [value]="sc">{{ sc }}</mat-option></mat-select></mat-form-field>
              </div>
              <div class="flex justify-end"><button type="button" class="h-10 px-6 rounded-md bg-orange-500 text-white" (click)="addAccepter()">Add</button></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Related Documents -->
      <div *ngIf="currentStep === 3" class="w-full flex flex-col gap-6">
        <div class="text-gray-900 text-lg font-medium bg-gradient-to-r from-[#080114] to-[#290967] bg-clip-text text-transparent">File Manual Document Upload</div>
        <div class="w-full rounded-lg border border-dashed border-primary-700 p-8">
          <div class="w-full min-h-[280px] flex items-center justify-center">
            <div class="flex flex-col items-center gap-4 text-center">
              <svg width="93" height="93" viewBox="0 0 93 93" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="23" y="9" width="47" height="75" rx="4" fill="#E5E7EB"/><path d="M31 23h31M31 35h31M31 47h31M31 59h23" stroke="#9CA3AF" stroke-width="3" stroke-linecap="round"/></svg>
              <div class="flex flex-col items-center gap-2">
                <div class="text-gray-900 text-xl font-semibold">Upload PDF Instruction Document</div>
                <div class="text-lg bg-gradient-to-r from-[#080114] to-[#290967] bg-clip-text text-transparent">Drag your PDF instruction document here or click to browse</div>
                <div class="text-gray-500 text-sm">Accepted format: .pdf | Max Size: 10 MB</div>
              </div>
              <button type="button" class="flex items-center gap-2 h-10 px-4 rounded bg-primary-700 text-white">
                <span class="font-medium">Choose Document</span>
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 2v14M2 9h14" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 4: Confirmation -->
      <div *ngIf="currentStep === 4" class="w-full flex flex-col gap-6">
        <div class="text-gray-900 text-base font-medium">Confirmation</div>
        <div class="rounded-2xl border border-dashed border-border bg-white p-5">
          <div class="flex items-center justify-between mb-4">
            <div class="text-primary-600 text-sm font-semibold">Basic File Information</div>
            <button type="button" class="h-8 px-3 rounded-md border border-gray-300 text-gray-700 bg-white" (click)="goToStep(1)">Edit</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div><div class="text-gray-500 text-xs">File ID</div><div class="text-gray-800">{{ templateInfoForm.value.templateId || '—' }}</div></div>
            <div><div class="text-gray-500 text-xs">Entity</div><div class="text-gray-800">{{ templateInfoForm.value.entity || '—' }}</div></div>
            <div><div class="text-gray-500 text-xs">Sector</div><div class="text-gray-800">{{ templateInfoForm.value.sector || '—' }}</div></div>
            <div><div class="text-gray-500 text-xs">Category</div><div class="text-gray-800">{{ templateInfoForm.value.category || '—' }}</div></div>
            <div><div class="text-gray-500 text-xs">Sub - Category</div><div class="text-gray-800">{{ templateInfoForm.value.subCategory || '—' }}</div></div>
            <div><div class="text-gray-500 text-xs">File Version</div><div class="text-gray-800">{{ templateInfoForm.value.fileVersion || '—' }}</div></div>
          </div>
        </div>

        <div class="rounded-2xl border border-dashed border-border bg-white p-5">
          <div class="flex items-center justify-between mb-4">
            <div class="text-primary-600 text-sm font-semibold">File Metadata & Configuration</div>
            <button type="button" class="h-8 px-3 rounded-md border border-gray-300 text-gray-700 bg-white" (click)="goToStep(1)">Edit</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2"><div class="text-gray-500 text-xs">Description</div><div class="text-gray-800">{{ metadataForm.value.description || '—' }}</div></div>
            <div><div class="text-gray-500 text-xs">Submission Frequency</div><div class="text-gray-800">{{ metadataForm.value.submissionFrequency || '—' }}</div></div>
            <div><div class="text-gray-500 text-xs">Effective Start Date</div><div class="text-gray-800">{{ metadataForm.value.effectiveStartDate ? (metadataForm.value.effectiveStartDate | date:'yyyy-MM-dd') : '—' }}</div></div>
            <div><div class="text-gray-500 text-xs">Effective End Date</div><div class="text-gray-800">{{ metadataForm.value.effectiveEndDate ? (metadataForm.value.effectiveEndDate | date:'yyyy-MM-dd') : '—' }}</div></div>
          </div>
        </div>

        <div class="rounded-2xl border border-dashed border-border bg-white p-5">
          <div class="flex items-center justify-between mb-4">
            <div class="text-primary-600 text-sm font-semibold">Assign Users</div>
            <button type="button" class="h-8 px-3 rounded-md border border-gray-300 text-gray-700 bg-white" (click)="goToStep(2)">Edit</button>
          </div>
          <div class="overflow-auto"><table class="w-full text-sm"><thead class="text-gray-500"><tr class="border-b"><th class="py-2 text-left font-medium">User Name</th><th class="py-2 text-left font-medium">Organization</th><th class="py-2 text-left font-medium">Type</th><th class="py-2 text-left font-medium">Permission Level</th><th class="py-2 text-left font-medium">Approval Flow</th><th class="py-2 text-left font-medium">Actions</th></tr></thead><tbody><tr *ngFor="let u of assignedUsers" class="border-b"><td class="py-2">{{ u.name }}</td><td class="py-2">{{ u.organization }}</td><td class="py-2">{{ u.type }}</td><td class="py-2">{{ u.permission }}</td><td class="py-2">{{ u.approval }}</td><td class="py-2"><button type="button" class="w-6 h-6 rounded bg-white border border-gray-300"></button></td></tr><tr *ngIf="assignedUsers.length===0"><td colspan="6" class="py-3 text-gray-500">No users assigned.</td></tr></tbody></table></div>
        </div>

        <div class="rounded-2xl border border-dashed border-border bg-white p-5">
          <div class="flex items-center justify-between mb-4">
            <div class="text-primary-600 text-sm font-semibold">File Manual Document</div>
            <button type="button" class="h-8 px-3 rounded-md border border-gray-300 text-gray-700 bg-white" (click)="goToStep(3)">Edit</button>
          </div>
          <div class="w-full min-h-[280px] rounded-md border border-gray-200 bg-gray-50 grid place-items-center text-gray-500">Document preview area</div>
        </div>
      </div>
    </div>

    <div class="flex justify-end gap-3 mt-6 pb-2">
      <button *ngIf="currentStep > 1" type="button" class="flex h-10 px-4 items-center gap-2 rounded border border-orange-500 bg-white text-orange-500 font-semibold" (click)="previousStep()"><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.25 13.5L6.75 9L11.25 4.5" stroke="#CE5212" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg><span>Back</span></button>
      <button type="button" class="flex h-10 px-4 items-center gap-2 rounded bg-orange-500 text-white" (click)="nextStep()"><span>{{ currentStep === 4 ? 'Confirm' : 'Next' }}</span><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.75 4.5L11.25 9L6.75 13.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
    </div>
  </div>
</div>
