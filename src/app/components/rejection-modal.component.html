<!-- Modal Backdrop -->
<div
  *ngIf="isOpen"
  class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"
  (click)="onBackdropClick($event)"
>
  <!-- Modal Content -->
  <div
    class="bg-white rounded-2xl max-w-[1600px] w-full max-h-[95vh] overflow-y-auto shadow-2xl"
    (click)="$event.stopPropagation()"
  >
    <div class="p-6 lg:p-8 xl:p-12">
      <!-- Header Section with Red Border -->
      <div
        class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-8 p-4 rounded-lg border border-[#DE1212]"
      >
        <!-- Left: Icon and Title -->
        <div class="flex items-center gap-5">
          <!-- Exclamation Icon -->
          <svg
            class="w-16 h-16 flex-shrink-0"
            width="65"
            height="65"
            viewBox="0 0 65 65"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_2733_4989)">
              <path
                d="M32.5 0C14.5525 0 0 14.5525 0 32.5C0 50.4475 14.5525 65 32.5 65C50.4475 65 65 50.4475 65 32.5C65 14.5525 50.4475 0 32.5 0ZM30.1786 16.8304C30.1786 16.5112 30.4397 16.25 30.7589 16.25H34.2411C34.5603 16.25 34.8214 16.5112 34.8214 16.8304V36.5625C34.8214 36.8817 34.5603 37.1429 34.2411 37.1429H30.7589C30.4397 37.1429 30.1786 36.8817 30.1786 36.5625V16.8304ZM32.5 48.75C31.5888 48.7314 30.7212 48.3564 30.0833 47.7054C29.4455 47.0544 29.0882 46.1793 29.0882 45.2679C29.0882 44.3565 29.4455 43.4814 30.0833 42.8304C30.7212 42.1794 31.5888 41.8043 32.5 41.7857C33.4112 41.8043 34.2788 42.1794 34.9167 42.8304C35.5545 43.4814 35.9118 44.3565 35.9118 45.2679C35.9118 46.1793 35.5545 47.0544 34.9167 47.7054C34.2788 48.3564 33.4112 48.7314 32.5 48.75Z"
                fill="#DE1212"
              />
            </g>
            <defs>
              <clipPath id="clip0_2733_4989">
                <rect width="65" height="65" fill="white" />
              </clipPath>
            </defs>
          </svg>

          <div class="flex flex-col gap-2">
            <h2
              class="text-[#232323] text-base font-medium font-['Poppins'] capitalize"
            >
              {{ submission?.id }} ({{ submission?.title }})
            </h2>
            <p
              class="text-[#6C6C6C] text-sm font-normal font-['Poppins'] capitalize"
            >
              {{ submission?.subId }}
            </p>

            <!-- Tags -->
            <div class="flex items-center gap-2.5 flex-wrap">
              <span
                *ngFor="let tag of submission?.tags"
                class="flex items-center justify-center px-2 py-1 rounded border-[0.25px] text-[10px] font-normal font-['Poppins'] capitalize"
                [style.borderColor]="tag.color"
                [style.color]="tag.color"
              >
                {{ tag.label }}
              </span>
            </div>
          </div>
        </div>

        <!-- Right: Dates and Actions -->
        <div class="flex flex-col items-start lg:items-end gap-3">
          <div
            class="flex flex-col lg:flex-row items-start lg:items-center gap-4 lg:gap-12"
          >
            <p
              class="text-[#212121] text-sm font-normal font-['Poppins'] capitalize"
            >
              Submitted: {{ submission?.submittedDate }}
            </p>
            <p
              class="text-[#DE1212] text-sm font-normal font-['Poppins'] capitalize"
            >
              Rejected:
              {{ submission?.rejectedDate || submission?.submittedDate }}
            </p>
          </div>

          <div class="flex items-center gap-3 flex-wrap">
            <!-- Download Error Report Button -->
            <button
              (click)="onDownloadErrorReport()"
              class="flex items-center gap-2 h-[33px] px-4 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <span
                class="text-[#080114] text-center text-sm font-normal font-['Poppins'] capitalize"
              >
                Download Error Report
              </span>
              <svg
                class="w-[19px] h-[19px]"
                viewBox="0 0 19 19"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M16.625 11.875V15.0417C16.625 15.4637 16.4574 15.8684 16.1589 16.1668C15.8605 16.4653 15.4558 16.6329 15.0337 16.6329H3.96667C3.54464 16.6329 3.13993 16.4653 2.84143 16.1668C2.54293 15.8684 2.375 15.4637 2.375 15.0417V11.875"
                  stroke="#080114"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M5.54167 7.91667L9.5 11.875L13.4583 7.91667"
                  stroke="#080114"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M9.5 11.875V2.375"
                  stroke="#080114"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>

            <!-- Comments Mode Toggle -->
            <div class="flex items-center gap-3">
              <label class="relative inline-flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  [(ngModel)]="commentsMode"
                  class="sr-only peer"
                />
                <div
                  class="w-[59px] h-[25px] bg-gray-100 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-[34px] after:content-[''] after:absolute after:top-[2.5px] after:left-[2px] after:bg-[#C1C7CD] peer-checked:after:bg-[#12CEB0] after:rounded-full after:h-[20px] after:w-[20px] after:transition-all"
                ></div>
              </label>
              <span
                class="text-black text-sm font-normal font-['Poppins'] opacity-80"
              >
                Comments Mode
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="grid grid-cols-1 xl:grid-cols-[1fr_320px] gap-6">
        <!-- Left Column -->
        <div class="flex flex-col gap-6">
          <!-- Data Table -->
          <div
            class="border border-dashed border-[#290967] rounded-2xl overflow-hidden"
          >
            <div class="p-4 lg:p-6">
              <!-- Table Header -->
              <h3
                class="text-[#080114] text-sm font-semibold font-['Poppins'] capitalize mb-4"
              >
                Data Table
              </h3>

              <!-- Scrollable Table Container -->
              <div class="overflow-x-auto">
                <table class="w-full border-collapse min-w-[800px]">
                  <thead>
                    <tr>
                      <th
                        class="border border-border-light text-black text-base font-medium font-['Poppins'] capitalize p-3 text-center"
                      >
                        Row#
                      </th>
                      <th
                        class="border border-border-light text-black text-base font-medium font-['Poppins'] capitalize p-3 text-center"
                      >
                        Installation ID
                      </th>
                      <th
                        class="border border-border-light text-black text-base font-medium font-['Poppins'] capitalize p-3 text-center"
                      >
                        Capacity (kW)
                      </th>
                      <th
                        class="border border-border-light text-black text-base font-medium font-['Poppins'] capitalize p-3 text-center"
                      >
                        Installation Date
                      </th>
                      <th
                        class="border border-border-light text-black text-base font-medium font-['Poppins'] capitalize p-3 text-center"
                      >
                        Comments
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let row of tableData">
                      <td
                        class="border border-border-light p-3 h-12 text-center relative"
                        [class.bg-red-50]="row.hasError"
                      >
                        <svg
                          *ngIf="row.hasError"
                          class="w-6 h-6 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M16.7135 6.64272V5.357C16.7135 5.23915 16.617 5.14272 16.4992 5.14272H6.21345C6.09559 5.14272 5.99916 5.23915 5.99916 5.357V6.64272C5.99916 6.76057 6.09559 6.857 6.21345 6.857H16.4992C16.617 6.857 16.7135 6.76057 16.7135 6.64272ZM6.21345 8.99986C6.09559 8.99986 5.99916 9.09629 5.99916 9.21414V10.4999C5.99916 10.6177 6.09559 10.7141 6.21345 10.7141H11.142C11.2599 10.7141 11.3563 10.6177 11.3563 10.4999V9.21414C11.3563 9.09629 11.2599 8.99986 11.142 8.99986H6.21345ZM16.2849 12.107C13.0893 12.107 10.4992 14.6972 10.4992 17.8927C10.4992 21.0883 13.0893 23.6784 16.2849 23.6784C19.4804 23.6784 22.0706 21.0883 22.0706 17.8927C22.0706 14.6972 19.4804 12.107 16.2849 12.107ZM19.1643 20.7722C18.3956 21.5409 17.3724 21.9641 16.2849 21.9641C15.1974 21.9641 14.1742 21.5409 13.4054 20.7722C12.6367 20.0034 12.2135 18.9802 12.2135 17.8927C12.2135 16.8052 12.6367 15.782 13.4054 15.0133C14.1742 14.2445 15.1974 13.8213 16.2849 13.8213C17.3724 13.8213 18.3956 14.2445 19.1643 15.0133C19.9331 15.782 20.3563 16.8052 20.3563 17.8927C20.3563 18.9802 19.9331 20.0034 19.1643 20.7722ZM15.4277 20.0356C15.4277 20.2629 15.518 20.4809 15.6788 20.6417C15.8395 20.8024 16.0576 20.8927 16.2849 20.8927C16.5122 20.8927 16.7302 20.8024 16.891 20.6417C17.0517 20.4809 17.142 20.2629 17.142 20.0356C17.142 19.8082 17.0517 19.5902 16.891 19.4295C16.7302 19.2687 16.5122 19.1784 16.2849 19.1784C16.0576 19.1784 15.8395 19.2687 15.6788 19.4295C15.518 19.5902 15.4277 19.8082 15.4277 20.0356ZM15.7492 18.3213H16.8206C16.9385 18.3213 17.0349 18.2249 17.0349 18.107V15.107C17.0349 14.9891 16.9385 14.8927 16.8206 14.8927H15.7492C15.6313 14.8927 15.5349 14.9891 15.5349 15.107V18.107C15.5349 18.2249 15.6313 18.3213 15.7492 18.3213ZM10.0706 21.107H3.85631V2.24986H18.8563V11.4641C18.8563 11.582 18.9527 11.6784 19.0706 11.6784H20.5706C20.6885 11.6784 20.7849 11.582 20.7849 11.4641V1.17843C20.7849 0.704325 20.4018 0.321289 19.9277 0.321289H2.78488C2.31077 0.321289 1.92773 0.704325 1.92773 1.17843V22.1784C1.92773 22.6525 2.31077 23.0356 2.78488 23.0356H10.0706C10.1884 23.0356 10.2849 22.9391 10.2849 22.8213V21.3213C10.2849 21.2034 10.1884 21.107 10.0706 21.107Z"
                            fill="#F35353"
                          />
                        </svg>
                      </td>
                      <td
                        class="border border-border-light p-3 h-12 text-center relative"
                        [class.bg-red-50]="row.hasError"
                      ></td>
                      <td
                        class="border border-border-light p-3 h-12 text-center relative"
                        [class.bg-red-50]="row.hasError"
                      ></td>
                      <td
                        class="border border-border-light p-3 h-12 text-center relative"
                        [class.bg-red-50]="row.hasError"
                      ></td>
                      <td
                        class="border border-border-light p-3 h-12 text-center relative"
                        [class.bg-red-50]="row.hasError"
                      ></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- General Rejection Comment -->
          <div
            class="border border-dashed border-[#290967] rounded-2xl p-6 lg:p-8"
          >
            <label
              class="block text-black text-sm font-semibold font-['Poppins'] opacity-80 mb-2"
            >
              General Rejection Comment
            </label>
            <textarea
              [(ngModel)]="generalRejectionComment"
              class="w-full h-32 resize-none border-b border-[#C1C7CD] outline-none focus:border-primary-500 transition-colors text-sm font-['Poppins'] p-2"
              placeholder="Enter rejection comment here..."
              readonly
            ></textarea>
          </div>
        </div>

        <!-- Right Column -->
        <div class="flex flex-col gap-6">
          <!-- Comments Section -->
          <div
            class="border border-dashed border-[#290967] rounded-2xl p-6 flex-1 min-h-[655px]"
          >
            <h3
              class="text-[#080114] text-sm font-semibold font-['Poppins'] capitalize"
            >
              Comments
            </h3>
          </div>

          <!-- Proceed to Resubmit Button -->
          <button
            (click)="onProceedToResubmit()"
            class="flex items-center justify-center gap-2 w-full h-[39px] px-4 rounded bg-[#CE5212] hover:bg-[#b84610] transition-colors"
          >
            <span
              class="text-white text-base font-medium font-['Poppins'] capitalize"
            >
              Proceed to Resubmit
            </span>
            <svg
              class="w-[18px] h-[18px]"
              viewBox="0 0 18 18"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M6.75 13.5L11.25 9L6.75 4.5"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
